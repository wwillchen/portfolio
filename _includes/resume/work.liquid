{%- comment -%}
Work experience list for revamped CV page with expandable items.
Uses legacy `data` pair or include.items.
Optional: include.only can be 'research' or 'work' to filter entries.
{%- endcomment -%}
{%- assign items = include.items | default: data[1] -%}
{%- if items and items != empty -%}
  {%- assign items = items | sort: 'startDate' | reverse -%}
{%- endif -%}

{%- if items and items != empty -%}
<ul class="cv-list">
  {%- for content in items -%}
    {%- assign startDate = content.startDate | date: "%B %Y" -%}
    {%- assign endRaw = content.endDate | default: 'Present' -%}
    {%- if endRaw == 'Present' -%}
      {%- assign endDate = 'Present' -%}
    {%- else -%}
      {%- assign endDate = endRaw | date: "%B %Y" -%}
    {%- endif -%}

    {%- comment -%} Determine if this entry is research-like {%- endcomment -%}
    {%- assign is_research = false -%}
    {%- if content.position and content.position contains 'Research' -%}
      {%- assign is_research = true -%}
    {%- elsif content.name and content.name contains 'Research' -%}
      {%- assign is_research = true -%}
    {%- endif -%}

    {%- comment -%} Apply optional filter: include.only == 'research' or 'work' {%- endcomment -%}
    {%- if include.only == 'research' and is_research != true -%}
      {%- continue -%}
    {%- elsif include.only == 'work' and is_research == true -%}
      {%- continue -%}
    {%- endif -%}

    <li class="cv-item" data-cv-toggle>
      <div class="cv-row">
        <div class="cv-title">
          <span class="cv-entity">{{ content.name | strip_html }}</span>
          <span class="cv-caret">▾</span>
        </div>
        <div class="cv-date">{{ startDate }} – {{ endDate }}</div>
      </div>
      {%- if content.position -%}
        <div class="cv-role">{{ content.position | strip_html }}</div>
      {%- endif -%}
      <div class="cv-item-details">
        {%- if content.summary -%}
          <div class="cv-subtitle">{{ content.summary | strip_html }}</div>
        {%- endif -%}
        {%- if content.highlights and content.highlights.size > 0 -%}
          <ul>
            {%- for item in content.highlights -%}
              <li>{{ item }}</li>
            {%- endfor -%}
          </ul>
        {%- endif -%}
      </div>
    </li>
  {%- endfor -%}
</ul>
{%- endif -%}
